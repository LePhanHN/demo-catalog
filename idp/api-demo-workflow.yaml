apiVersion: scaffolder.backstage.io/v1beta3
kind: Template
metadata:
  name: api-demo
  title: api-demo
  description: api-demo
spec:
  owner: DCP
  type: service
  parameters:
parameters:
  - title: Fill in the repo details
    properties:
      token:
        title: Harness Token
        type: string
        ui:widget: password
        ui:field: HarnessAuthToken
      aws_account:
        type: string
        ui:field: SelectFieldFromApi
        ui:options:
          title: AWS Account
          description: Pick one of the AWS Account
          placeholder: Choose an AWS Account
          path: proxy/demo-api
          params:
            action: listAccounts
          valueSelector: Id
          allowArbitraryValues: true
      aws_region:
        type: string
        ui:field: SelectFieldFromApi
        ui:options:
          title: Regions
          description: Regions
          placeholder: Choose a Region
          path: proxy/demo-api
          params:
            action: listRegions
          valueSelector: region
          allowArbitraryValues: false
      vpc:
        type: string
        ui:field: SelectFieldFromApi
        ui:options:
          title: VPC
          description: VPC
          placeholder: Select VPC
          path: proxy/demo-api
          params:
            action: listVPCs
            account_id: abc
            region: us-west-2
          valueSelector: VpcId
          allowArbitraryValues: false
      team:
        title: Team
        type: string
        description: Team
        ui:field: MyGroupsPicker    
      entity:
        title: Entity
        type: string          
     
  - title: reference
    properties:
      env:
        type: string
        ui:field: SelectFieldFromApi
        ui:options:
          title: env
          description: env
          placeholder: Select env
          path: proxy/harness-api/278oQOylSUWVALR6dOgnhg/idp/api/catalog/entities
          params:
            filter: kind=resource,spec.owner={{ parameters.team }}
          valueSelector: metadata.name
          allowArbitraryValues: false 
  
  steps:
    - id: trigger
      name: Onboarding a New GitHub Repository
      action: trigger:harness-custom-pipeline
      input:
        url: https://app.harness.io/ng/account/278oQOylSUWVALR6dOgnhg/module/ci/orgs/default/projects/DirectTVDemo/pipelines/GitHub_Repository_Onboarding_Clone_Clone/pipeline-studio?storeType=INLINE
        inputset:
          aws_account: ${{ parameters.aws_account }}
        apikey: ${{ parameters.token }}
        showOutputVariables: true
  output:
    links:
      - title: Pipeline Details
        url: ${{ steps.trigger.output.PipelineUrl }}
    text:
      - title: Outputs
        content: |
          return: ${{steps.trigger.output.RETURN_VAL}},github_org_name: ${{ parameters.github_org_name}},github_repo_name: ${{ parameters.github_repo_name}}



          
